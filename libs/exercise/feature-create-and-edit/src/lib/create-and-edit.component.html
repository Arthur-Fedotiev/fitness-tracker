<main class="main-container">
  <section class="create-exercise-section">
    <h3>Create New Exercise</h3>
    <form
      #exerciseForm="ngForm"
      ftE2e="exerciseCreateAndEditForm"
      class="exercise-form"
    >
      <mat-form-field appearance="outline">
        <input
          placeholder="Exercise name"
          matInput
          required
          name="name"
          ftE2e="exerciseNameInput"
          [(ngModel)]="exerciseFormModel.name"
        />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-select
          required
          placeholder="Select Exercise Type"
          name="exerciseType"
          [(ngModel)]="exerciseFormModel.exerciseType"
          ftE2e="exerciseTypeSelect"
        >
          <mat-option
            *ngFor="let exerciseType of exerciseDescriptors.exerciseTypes"
            [value]="exerciseType"
            >{{
              'EXERCISE-TYPES.' + exerciseType | translate | titlecase
            }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-select
          required
          placeholder="Select target muscle"
          name="targetMuscle"
          [(ngModel)]="exerciseFormModel.targetMuscle"
          ftE2e="exerciseTargetMuscleSelect"
        >
          <mat-option
            *ngFor="let muscle of exerciseDescriptors.muscles"
            [value]="muscle"
            >{{ 'MUSCLES.' + muscle | translate | titlecase }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-select
          required
          placeholder="Select Equipment"
          name="equipment"
          [(ngModel)]="exerciseFormModel.equipment"
          ftE2e="exerciseEquipmentSelect"
        >
          >
          <mat-option
            *ngFor="let equipmentItem of exerciseDescriptors.equipment"
            [value]="equipmentItem"
            >{{
              'EQUIPMENT.' + equipmentItem | translate | titlecase
            }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <mat-form-field *ftRoles="Roles.ADMIN" appearance="outline">
        <input
          placeholder="Avatar url"
          matInput
          name="avatarUrl"
          [(ngModel)]="exerciseFormModel.avatarUrl"
          ftE2e="exerciseAvatarUrlInput"
        />
      </mat-form-field>

      <mat-form-field *ftRoles="Roles.ADMIN" appearance="outline">
        <input
          placeholder="Avatar secondary url"
          matInput
          name="avatarSecondaryUrl"
          ftE2e="exerciseAvatarSecondaryUrlInput"
          [(ngModel)]="exerciseFormModel.avatarSecondaryUrl"
        />
      </mat-form-field>
      <mat-form-field *ftRoles="Roles.ADMIN" appearance="outline">
        <input
          placeholder="Instructions video"
          matInput
          name="instructionVideo"
          [(ngModel)]="exerciseFormModel.instructionVideo"
          ftE2e="exerciseInstructionVideoInput"
        />
      </mat-form-field>

      <div ngModelGroup="instructions" class="instructions-container">
        <h2>Instructions</h2>

        <div
          class="instructions-group"
          *ngFor="
            let instruction of exerciseFormModel.instructions;
            let i = index;
            trackBy: trackByFn
          "
        >
          <mat-form-field class="instruction-input" appearance="outline">
            <mat-label>Instruction {{ i + 1 }}</mat-label>
            <textarea
              placeholder="Instruction"
              matInput
              name="{{ i }}"
              cdkTextareaAutosize
              ftE2e="exerciseInstructionInput"
              [(ngModel)]="exerciseFormModel.instructions[i]"
            ></textarea>
          </mat-form-field>
          <button
            mat-icon-button
            color="warn"
            (click)="removeInstruction(i)"
            ftE2e="removeExerciseInstructionBtn"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </form>
    <div class="form-actions">
      <button
        mat-raised-button
        color="primary"
        (click)="exerciseFormModel.instructions.push('')"
        ftE2e="addExerciseInstructionBtn"
      >
        ADD INSTRUCTION
      </button>
      <button
        mat-raised-button
        color="warn"
        ftE2e="saveExerciseBtn"
        [disabled]="!exerciseForm.valid || !exerciseForm.dirty"
        (click)="onSave()"
      >
        SAVE
      </button>
    </div>
  </section>
</main>
