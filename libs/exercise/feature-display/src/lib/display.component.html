<main class="main-page">
  <section>
    <button
      *ngIf="false"
      fxHide.gt-xs
      mat-button
      class="mat-raised-button mat-accent"
    >
      SHOW FILTERS
    </button>
  </section>

  <article class="exercises-list">
    <ft-muscle-multi-select
      ngClass.gt-sm="filters-large"
      fxLayout
      [initialTargetMuscles]="(targetMuscles$ | async)!"
      [muscleList]="exerciseDescriptors.muscles"
      (targetMusclesFiltersChanges)="targetMusclesChanges($event)"
    ></ft-muscle-multi-select>

    <components-exercise-list
      [exerciseList]="exercises()"
      [selectedForWorkoutIds]="selectedForWorkoutIds.asReadonly()"
      [isWorkoutCreationMode]="isWorkoutCreationMode"
      (exerciseEdited)="navigate(exerciseMode.EDIT, $event)"
      (exerciseViewed)="showExerciseDetails($event)"
      (exerciseDeleted)="deleteExercise($event)"
      (exerciseAddedToWorkout)="addToComposedWorkout($event)"
      (exerciseRemovedFromWorkout)="removeFromComposedWorkout($event)"
    ></components-exercise-list>
  </article>

  <mat-accordion *ngIf="exercises().length" class="composed-workout-section">
    <mat-expansion-panel #panel class="mat-app-background" hideToggle disabled>
      <mat-expansion-panel-header>
        <mat-panel-title class="actions">
          <button
            *ngIf="!isWorkoutCreationMode"
            mat-stroked-button
            class="action"
            color="accent"
            (click)="isWorkoutCreationMode = true"
          >
            Create workout
          </button>
          <ng-container *ngIf="isWorkoutCreationMode"
            ><button
              mat-stroked-button
              class="action"
              color="accent"
              [disabled]="!selectedForWorkoutIds().size"
              (click)="finishComposing()"
            >
              Proceed
            </button>

            <button
              mat-stroked-button
              class="action"
              color="warn"
              (click)="cancelComposing()"
            >
              Cancel
            </button>
          </ng-container>
        </mat-panel-title>
        <button
          *ngIf="selectedForWorkoutIds().size"
          mat-icon-button
          aria-label="Selected exercises"
          color="primary"
          (click)="panel.toggle()"
        >
          <mat-icon
            [matBadge]="selectedForWorkoutIds().size"
            matBadgeColor="accent"
            matBadgeSize="small"
            matBadgeOverlap
            >search</mat-icon
          >
        </button>
      </mat-expansion-panel-header>
      <div class="selected-exercises-section">
        <mat-card
          *ngFor="let exercise of selectedForWorkoutExercises()"
          class="selected-exercise mat-elevation-z8"
          tabindex="0"
        >
          <img
            mat-card-sm-image
            class="card__avatar"
            alt="Exercise avatar"
            [src]="exercise.avatarUrl"
            ftWithFallback
          />

          <mat-card-title class="card__title">
            {{ exercise.name }}
          </mat-card-title>
          <button
            mat-icon-button
            aria-label="Remove exercises"
            (click)="removeFromComposedWorkout(exercise.id)"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-card>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</main>
