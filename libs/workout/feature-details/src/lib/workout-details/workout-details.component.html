<article *ngIf="workoutDetails$ | async as workout" class="wrapper">
  <header class="workout-header">
    <img
      class="workout-avatar"
      [src]="workout.avatarUrl"
      alt="{{ workout.name }}"
    />
    <div class="workout-info">
      <h1 class="mat-headline-2">{{ workout.name | uppercase }}</h1>
      <p>By FitnessTracker</p>
      <div class="info-blocks">
        <div>
          <p class="mat-subtitle-1">
            {{ workout.estimatedDurationMin + ' min' }}
          </p>
          <p class="mat-caption">EST DURATION</p>
        </div>
        <div>
          <p class="mat-subtitle-1">{{ workout.totalExercises }}</p>
          <p>EXERCISES</p>
        </div>
        <div>
          <p class="mat-subtitle-1">{{ workout.totalReps }}</p>
          <p>TOTAL REPS</p>
        </div>
      </div>
    </div>
  </header>
  <section class="workout-wrapper">
    <ng-container *ngFor="let workoutItem of workout.content; first as first">
      <ng-template
        [ngTemplateOutlet]="workoutTpl"
        [ngTemplateOutletContext]="{ $implicit: workoutItem, first }"
      ></ng-template>
    </ng-container>
  </section>
</article>

<ng-template #workoutTpl let-item let-first="first">
  <mat-divider *ngIf="!first" class="divider"></mat-divider>
  <div *ngIf="item.children" class="superset-description">
    <h2>{{ 'compoundTypes.superset' | translate | uppercase }}</h2>
    <p [translate]="'supersetNotes'"></p>
    <p
      [translate]="'restPause'"
      [translateParams]="{
        restPauseBetween: item.restPauseBetween,
        restPauseAfterComplete: item.restPauseAfterComplete
      }"
    ></p>
  </div>

  <ng-container *ngIf="item.children?.length">
    <ng-container *ngFor="let item of item.children; index as idx">
      <ng-template
        [ngTemplateOutlet]="workoutSingleItem"
        [ngTemplateOutletContext]="{ $implicit: item, isChild: true }"
      ></ng-template>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="!item.children">
    <h2 class="single-item-title">
      <ng-container
        *ngTemplateOutlet="titleTpl; context: { $implicit: item.name }"
      ></ng-container>
    </h2>
    <ng-template
      [ngTemplateOutlet]="workoutSingleItem"
      [ngTemplateOutletContext]="{ $implicit: item, isChild: false }"
    ></ng-template>
  </ng-container>
</ng-template>

<ng-template #workoutSingleItem let-item let-isChild="isChild">
  <mat-card class="card mat-elevation-z8" tabindex="0">
    <mat-card-title-group>
      <div class="card__avatar-container">
        <img
          class="card__avatar"
          mat-card-sm-image
          alt="{{ item.name }} avatar"
          [src]="item.avatarUrl"
          ftWithFallback
        />
        <img
          mat-card-sm-image
          ftWithFallback
          class="card__avatar"
          alt="{{ item.name }} avatar"
          [src]="item.avatarSecondaryUrl"
        />
      </div>

      <mat-card-title *ngIf="isChild" class="mat-headline-5">
        <ng-container
          *ngTemplateOutlet="titleTpl; context: { $implicit: item.name }"
        ></ng-container>
      </mat-card-title>
      <mat-card-subtitle class="mat-body-1">
        <span *ngIf="!isChild">
          {{ 'totalSets' | translate }} - {{ item.totalSets }},</span
        >
        {{ 'instructions.' + item.type | translate | titlecase }} -
        {{ item.load }} {{ 'instructions.units.' + item.type | translate }}
        <span
          *ngIf="!isChild"
          [translate]="'notChildRest'"
          [translateParams]="{
            restPauseBetween: item.restPauseBetween,
            restPauseAfterComplete: item.restPauseAfterComplete
          }"
        ></span>
      </mat-card-subtitle>
    </mat-card-title-group>
    <mat-card-actions class="card__actions">
      <button
        mat-stroked-button
        class="mat-raised-button mat-primary"
        (click)="showExerciseDetails(item.id)"
      >
        {{ 'viewInstructionsBtn' | translate }}
      </button>
    </mat-card-actions>
  </mat-card>
</ng-template>
<ng-template #titleTpl let-title
  ><span>{{ title }}</span></ng-template
>
