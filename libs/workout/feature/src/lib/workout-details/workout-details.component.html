<article fxLayout="column nowrap"
         *ngIf="workoutDetails$ | async as workout">
  <header class="workout-header">
    <div class="workout-header__content"
         fxLayout="column nowrap"
         fxLayoutAlign="space-between center">
      <h1> {{ workout.name }}</h1>
      <p>{{ workout.description }}</p>
    </div>

  </header>
  <section fxFlex.sm="80%"
           fxFlex.md="65%"
           fxFlex.lg="55%"
           fxFlex.xl="45%"
           class="workout-wrapper">

    <ng-container *ngFor="let workoutItem of workout.content; first as first;">
      <ng-template [ngTemplateOutlet]="workoutTpl"
                   [ngTemplateOutletContext]="{$implicit: workoutItem, first }"></ng-template>
    </ng-container>
  </section>
</article>

<ng-template #workoutTpl
             let-item
             let-first="first">
  <mat-divider *ngIf="!first"
               class="divider"></mat-divider>
  <div *ngIf="item.children"
       class="workout-item-description">
    <h1> {{ item.name }} </h1>
    <p>Perform the exercises in order, resting as little as possible between movements. </p>

    <p>Sets - {{ item.totalSets }}, times - {{ item.load }}</p>
    <p> Rest between sets - {{ item.restPauseBetween}} sec., and after all sets done - {{ item.restPauseAfterComplete }} sec.</p>
  </div>

  <ng-container *ngIf="item.children?.length">
    <ng-container *ngFor="let item of item.children; index as idx;">
      <ng-template [ngTemplateOutlet]="workoutSingleItem"
                   [ngTemplateOutletContext]="{$implicit: item, isChild: true}"></ng-template>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="!item.children">
    <ng-template [ngTemplateOutlet]="workoutSingleItem"
                 [ngTemplateOutletContext]="{$implicit: item, isChild: false}"></ng-template>
  </ng-container>

</ng-template>

<ng-template #workoutSingleItem
             let-item
             let-isChild="isChild">
  <mat-card class="card mat-elevation-z8"
            tabindex="0">
    <mat-card-title-group>
      <div class="card__avatar-container"><img class="card__avatar"
             mat-card-sm-image
             [src]="item.avatarUrl"
             ftWithFallback>
        <img class="card__avatar"
             mat-card-sm-image
             [src]="item.avatarSecondaryUrl"
             ftWithFallback>
      </div>

      <mat-card-title class="card__title">
        <span ngClass.xs="ft-xs"
              ngClass.sm="ft-sm"
              ngClass.md="ft-md"
              ngClass.lg="ft-lg"
              ngClass.xl="ft-xl">{{ item.name }}</span>
      </mat-card-title>
      <mat-card-subtitle>
        <span *ngIf="!isChild">Sets - {{ item.totalSets }}, </span>reps/duration - {{ item.load }} <span *ngIf="!isChild">(rest {{ item.restPauseBetween }} sec.)</span>
      </mat-card-subtitle>

    </mat-card-title-group>
    <mat-card-actions class="card__actions">
      <button mat-button
              class="mat-raised-button mat-primary"
              (click)="showExerciseDetails(item.id)">
        VIEW INSTRUCTIONS
      </button>
    </mat-card-actions>
  </mat-card>
</ng-template>
